// Définition des dépendances
const satellites = require("./satellites.js")

// Définition des dictionnaires
var renderer_dict = {
		"space view" : {"on": false},
		"ground track" : {"on": false},
		"graphics" : {"on": false, "values": {}}
	}

// Gestion de l'ajout et de l'affichage de nouveaux satellites
var sat_names = []
document.querySelector(".add_satellite").addEventListener("click", () => {
	sat_names = satellites.send_satellites_names()
	var forms_ = document.querySelectorAll(".satellites_list")
	for(var i=0 ; i<forms_.length ; i++) {
		displaySatForm(forms_[i])
	}
})

// Création de la liste de satellites
function displaySatForm (sat_form_) {

	var div_ = document.createElement("div")
	div_.style.marginLeft = "30px"

	var checkbox_ = document.createElement("input")
	checkbox_.type = "checkbox"
	checkbox_.name = sat_names[sat_names.length-1]
	checkbox_.id = sat_names[sat_names.length-1]

	var label_ = document.createElement("label")
	label_.for = sat_names[sat_names.length-1]
	label_.classList.add("text")
	label_.classList.add("medium")
	label_.style.marginLeft = "15px"
	label_.style.fontSize = "1.15em"
	label_.innerHTML = sat_names[sat_names.length-1]

	div_.appendChild(checkbox_)
	div_.appendChild(label_)

	sat_form_.appendChild(div_)
}


// Gestion de l'ajout de nouveaux paramètres à l'onglet "Graphic"
function addParameterToList () {

	// Création de la liste accueillant les noms de satellites
	let names_list = []

	// Récupération du paramètre à ajouter
	let prm_ = document.querySelector("#adding_prm_panel")
	console.log(prm_.value)

	// Récupération des satellites à afficher et ajout à la liste
	let sat_list_ = document.querySelector("#sat_to_display .satellites_list").childNodes
	for(var i=0 ; i<sat_list_.length ; i++) {
		if (sat_list_[i].querySelector("input").checked == true)
			names_list.push(sat_list_[i].querySelector("input").name)
	}

	// Création de la paire clé / valeur et ajout au dictionnaire renderer_dict
	renderer_dict["graphics"]["values"][prm_.value] = names_list


	// Affichage dans l'élement displayer
	let prm_displayer = document.querySelector("#prm_displayer")

	let main_div = document.createElement("div")

	let prm_parag = document.createElement("p")
	prm_parag.innerHTML = prm_.value
	prm_parag.classList.add("text")
	prm_parag.classList.add("medium")
	prm_parag.style.textAlign = "center"
	prm_parag.style.marginBottom = "0px"

	let sat_div = document.createElement("div")
	sat_div.style.display = "flex"
	sat_div.style.flexWrap = "wrap"
	sat_div.style.justifyContent = "space-around"
	sat_div.style.marginTop = "0px"

	for (var i=0 ; i<sat_list_.length ; i++) {
		let sat_parag = document.createElement("p")
		sat_parag.classList.add("text")
		sat_parag.classList.add("small")

		sat_parag.innerHTML = sat_list_[i].querySelector("input").name

		sat_parag.style.marginTop = "2px"
		sat_parag.style.marginRight = "10px"
		sat_parag.style.marginBottom = "5px"

		sat_div.appendChild(sat_parag)
	}

	main_div.appendChild(prm_parag)
	main_div.appendChild(sat_div)
	prm_displayer.appendChild(main_div)

	// Remise à zéro des champs
	prm_.value = "a"
	for(var i=0 ; i<sat_list_.length ; i++) {sat_list_[i].querySelector("input").checked = false}
	
	document.querySelector("#add_prm_to_graphs").style.display = "none"
}


document.querySelector("#add_prm").addEventListener("click", () => { document.querySelector("#add_prm_to_graphs").style.display = "flex"})
document.querySelector("#validate").addEventListener("click", addParameterToList)

document.querySelector("#space_view_button").addEventListener("click", (e) => {
	let yes_btn = document.querySelector("#space_view_button .yes_btn"),
		no_btn = document.querySelector("#space_view_button .no_btn")

	if(yes_btn.style.display == "none") {
		yes_btn.style.display = "block"
		no_btn.style.display = "none"
	}
	else {
		yes_btn.style.display = "none"
		no_btn.style.display = "block"
	}
})

document.querySelector("#ground_track_button").addEventListener("click", (e) => {
	let yes_btn = document.querySelector("#ground_track_button .yes_btn"),
		no_btn = document.querySelector("#ground_track_button .no_btn")

	if(yes_btn.style.display == "none") {
		yes_btn.style.display = "block"
		no_btn.style.display = "none"
	}
	else {
		yes_btn.style.display = "none"
		no_btn.style.display = "block"
	}
})

document.querySelector("#exploitation_button").addEventListener("click", (e) => {
	let yes_btn = document.querySelector("#exploitation_button .yes_btn"),
		no_btn = document.querySelector("#exploitation_button .no_btn")

	if(yes_btn.style.display == "none") {
		yes_btn.style.display = "block"
		no_btn.style.display = "none"
	}
	else {
		yes_btn.style.display = "none"
		no_btn.style.display = "block"
	}
})

function buildRendererDict () {

	let space_view_on_btn_ = document.querySelector("#ground_track_button .yes_btn"),
		ground_track_on_btn_ = document.querySelector("#exploitation_button .yes_btn"),
		exploitation_on_btn_ = document.querySelector("#exploitation_button .yes_btn")

	if (space_view_button.style.display != "none") {
		renderer_dict["space view"]["on"] = true
	}

	if (ground_track_on_btn_.style.display != "none") {
		renderer_dict["ground track"]["on"] = true

		renderer_dict["ground track"]["sat_names"] = []

		let box_list_ = document.querySelectorAll("#ground_track_selector input")
		for(var i=0 ; i<box_list_.length ; i++) {
			if (box_list_[i].checked == true)
				renderer_dict["ground track"]["sat_names"].push(box_list_[i].name)
		}
	}

	if(exploitation_on_btn_.style.display != "none") {
		renderer_dict["graphics"]["on"] = true
	}

}

document.querySelector("#exploitation").addEventListener("click", () => {buildRendererDict()})

module.exports = 
{
	sendExploitation : function sendExploitation () {return renderer_dict}
}
