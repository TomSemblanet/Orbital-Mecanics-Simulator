const satellites = require("./satellites.js")

let add_prm_button = document.querySelector("#add_prm") // Selection du bouton '+' ouvrant la fenêtre d'ajout d'un nouveau paramètres
add_prm_button.addEventListener("click", () => { document.querySelector("#add_prm_to_graphs").style.display = "block"}) // // [LISTENER] Ouvre la fenêtre d'ajout d'un nouveau paramètre

let new_prm_validation = document.querySelector("#validate") // Selection du bouton '+' dans la fenêtre de création d'un nouveau paramètres
new_prm_validation.addEventListener("click", addParameterToList) // [LISTENER] 

let space_view_on = document.querySelector("#space_view_button") // Selection du bouton de validation du panneau "space view"
space_view_on.addEventListener("click", () => {on_off_switcher("space_view")}) // [LISTENER] 

let ground_track_on = document.querySelector("#ground_track_button")// Selection du bouton de validation du panneau "ground track"
ground_track_on.addEventListener("click", () => {on_off_switcher("ground_track")}) // [LISTENER] 

let graphics_on = document.querySelector("#graphics_button") // Selection du bouton de validation du panneau "graphics"
graphics_on.addEventListener("click", () => {on_off_switcher("graphics")}) // [LISTENER] 

let final_validation = document.querySelector("#exploitation")
final_validation.addEventListener("click", buildRendererDict)


// Définition des dictionnaires
var renderer_dict = {
		"space view" : {"on": false},
		"ground track" : {"on": false, "sat_names": []},
		"graphics" : {"on": false, "values": {}}
	}

function on_off_switcher (panel_name) {
	// Gestion des boutons on / off pour chaque panneau "space view" / "ground track" & "graphics" 

	let yes_btn = document.querySelector("#" + panel_name + "_button .yes_btn"),
		no_btn = document.querySelector("#" + panel_name + "_button .no_btn")

	if(yes_btn.style.display == "none") {
		yes_btn.style.display = "block"
		no_btn.style.display = "none"
	}
	else {
		yes_btn.style.display = "none"
		no_btn.style.display = "block"
	}
}



// Gestion de l'ajout et de l'affichage de nouveaux satellites
var current_sat_names = []

function displaySatForm (sat_form_) {
	// Ajoute le dernier satellite ajouté à la liste current_sat_names au formulaire passé en argument
	// . Création d'une nouvelle checkbox liée au nom du dernier satellite crée
	// . Ajout de cette nouvelle checkbox au formulaire passé en argument

	var div_ = document.createElement("div")
	div_.style.marginLeft = "30px"

	var checkbox_ = document.createElement("input")
	checkbox_.type = "checkbox"
	checkbox_.name = current_sat_names[current_sat_names.length-1]
	checkbox_.id = current_sat_names[current_sat_names.length-1]

	var label_ = document.createElement("label")
	label_.for = current_sat_names[current_sat_names.length-1]
	label_.classList.add("text")
	label_.classList.add("medium")
	label_.style.marginLeft = "15px"
	label_.style.fontSize = "1.15em"
	label_.innerHTML = current_sat_names[current_sat_names.length-1]

	div_.appendChild(checkbox_)
	div_.appendChild(label_)

	sat_form_.appendChild(div_)
}



function addParameterToList () {
	// Gestion de l'ajout de nouveaux paramètres à l'onglet "Graphic"

	// Création de la liste accueillant les noms de satellites
	let names_list = []

	// Récupération du paramètre à ajouter
	let prm_ = document.querySelector("#adding_prm_panel")

	// Récupération des satellites à afficher et ajout à la liste
	let sat_list_ = document.querySelector("#sat_to_display .satellites_list").childNodes
	for(var i=0 ; i<sat_list_.length ; i++) {
		if (sat_list_[i].querySelector("input").checked == true) 
			names_list.push(sat_list_[i].querySelector("input").name)
	}

	// Création de la paire clé / valeur et ajout au dictionnaire renderer_dict
	renderer_dict["graphics"]["values"][prm_.value] = names_list


	// Affichage dans l'élement displayer
	let prm_displayer = document.querySelector("#prm_displayer")

	let main_div = document.createElement("div")

	let prm_parag = document.createElement("p")
	prm_parag.innerHTML = prm_.value
	prm_parag.classList.add("text")
	prm_parag.classList.add("medium")
	prm_parag.style.textAlign = "center"
	prm_parag.style.marginBottom = "0px"

	let sat_div = document.createElement("div")
	sat_div.style.display = "flex"
	sat_div.style.flexWrap = "wrap"
	sat_div.style.justifyContent = "space-around"
	sat_div.style.marginTop = "0px"

	for (var i=0 ; i<names_list.length ; i++) {
		let sat_parag = document.createElement("p")
		sat_parag.classList.add("text")
		sat_parag.classList.add("small")

		sat_parag.innerHTML = names_list[i]

		sat_parag.style.marginTop = "2px"
		sat_parag.style.marginRight = "10px"
		sat_parag.style.marginBottom = "5px"

		sat_div.appendChild(sat_parag)
	}

	main_div.appendChild(prm_parag)
	main_div.appendChild(sat_div)
	prm_displayer.appendChild(main_div)

	// Remise à zéro des champs
	prm_.value = "Demi grand-axe"
	for(var i=0 ; i<sat_list_.length ; i++) {sat_list_[i].querySelector("input").checked = false}
	
	document.querySelector("#add_prm_to_graphs").style.display = "none"
}

function buildRendererDict () {
	// Création finale du dictionnaire "renderer_dict" qui sera renvoyé à l'index.js

	let space_view_on_btn_ = document.querySelector("#space_view_button .yes_btn"),
		ground_track_on_btn_ = document.querySelector("#ground_track_button .yes_btn"),
		exploitation_on_btn_ = document.querySelector("#graphics_button .yes_btn")

	// ------ SPACE VIEW ------
	if (space_view_button.style.display != "none") 
		renderer_dict["space view"]["on"] = true
	else
		renderer_dict["space view"]["on"] = false

	

	// ------ GROUND TRACK ------
	if (ground_track_on_btn_.style.display != "none") {
		renderer_dict["ground track"]["on"] = true

		renderer_dict["ground track"]["sat_names"] = []

		let box_list_ = document.querySelectorAll("#ground_track_selector input")
		for(var i=0 ; i<box_list_.length ; i++) {
			if (box_list_[i].checked == true)
				renderer_dict["ground track"]["sat_names"].push(box_list_[i].name)
		}
	}
	else
		renderer_dict["ground track"]["on"] = false


	// ------ CHARTS ------
	if(exploitation_on_btn_.style.display != "none") 
		renderer_dict["graphics"]["on"] = true
	else 
		renderer_dict["graphics"]["on"] = false
}


module.exports = 
{
	sendExploitation : function sendExploitation () {return renderer_dict},

	newSatellite : function newSatellite (sat_list) {
		for (var i=0 ; i<sat_list.length ; i++)
			current_sat_names.push(sat_list[i]["name"])

		var forms_ = document.querySelectorAll(".satellites_list")
		for(var i=0 ; i<forms_.length ; i++) 
			displaySatForm(forms_[i])
	}
}
